<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
    <div id="greetapp"><SPAN class="name">姓名：<input type="text" id="name"></input><SPAN class="help-inline"></SPAN></SPAN><br/>
    <SPAN class="mobile">手机：<input type="text" id="mobile"></input><SPAN class="help-inline"></SPAN></SPAN><br/>
   <SPAN class="greet">一句话：<input type="text" id="greet"></input><SPAN class="help-inline"></SPAN></SPAN><br/>
   <button id="check">提交</button>
    <ul id="world-list"></ul></div>
    
 
<script type="text/javascript" src="http://img.soufun.com/rent/image/rent/js/maplist/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="underscore.js"></script>
<script type="text/javascript" src="backbone.js"></script>
<script>
    (function($){
        var Greet=Backbone.Model.extend({
            name:'',  //创建一个World对象，拥有name属性
            mobile:'',
            greet:'',
            url:'/soufun/',
            validate: function(attrs, options) {
                var errors = []; 
                if (!attrs.name) {
                    errors.push({name: 'name', message: '请留下您的大名'});
                }
                if (!attrs.mobile) {
                    errors.push({name: 'mobile', message: '请输入手机号码'});
                }
                if (!attrs.greet) {
                    errors.push({name: 'greet', message: '请填写一句问候'});
                }
                return errors.length > 0 ? errors : false;
            }

        });

        var Greets = Backbone.Collection.extend({
            //World对象的集合
            model: Greet            
        });

        var AppView = Backbone.View.extend({
            el:$('#greetapp'),
            initialize:function(){
                this.greets = new Greets(null,{//构造函数，实例化一个Worlds的集合类，并且以字典的方式传入AppView对象
                    view:this
                });
            },
            events:{
                'click #check':'checkIn',//事件绑定，绑定Dom中id为check的元素               
            },
            checkIn:function(){
                
                var greet = new Greet({
                    name:$("#name").val(),
                    mobile:$("#mobile").val(),
                    greet:$("#greet").val()
                });
                this.greets.add(greet);
                var me = this;
                var options = {
                    success: function () {
                        me.hideErrors();
                    },
                    error: function (model, errors) {
                        me.showErrors(errors);
                    }
                };
                greet.on({
                    "invalid": this.showErrors,
                    "sync":this.hideErrors,
                    "error":function(){
                        alert("请求失败")
                    }
                });
                greet.save();
            },
            addOneGreet:function(model){
                $('#world-list').append('<li>这里是来自<b>' +
                        model.get('name') +
                '</b>的问候：'+model.get('greet')+'！,'+model.get('mobile')+'</li>')
            },
            showErrors: function(errors) {
                $('.help-inline').text('');
                _.each(errors.validationError, function (error) {
                    var controlGroup = $('.' + error.name);
                    controlGroup.addClass('error');
                    controlGroup.find('.help-inline').text(error.message);
                }, this);
            },
            hideErrors: function () {
                $('.control-group').removeClass('error');
                $('.help-inline').text('');
            }
        });
        var appView=new AppView;
    })(jQuery)    

</script>
</body>
</html>