
<html xmlns:ng="http://angularjs.org">
<head>
    <meta name="viewport" content="width=device-width" />
    <title>专题列表</title>
    <link href="~/Resource/Css/Site.css" rel="stylesheet" />
    <script src="http://esf.js.soufunimg.com/esf/zu/js/complied/html5shiv.min.js"></script>
    <script src="http://esf.js.soufunimg.com/esf/zu/js/json2.js"></script>
    <script src="http://esf.js.soufunimg.com/esf/zu/js/complied/angular.min.js?v=5" type="text/javascript"></script>
</head>
<body>
    <div class="slshowPart">
    <div ng-app="myApp" class="ng-app:myApp" id="ng-app"  ng-controller="ListController">
       房源id<input type="text" ng-model="query" />
            专题名称<select ng-model="droptype">
                <option value="1">top10专题</option>
                <option value="2">房管房专题</option>
            </select>
            <input type="button" value="查询" ng-click="pageIndex=1;search()" />
            <div class="sldatafix">
                <table class="sldatatablefix">
                    <thead>
                        <tr class="sldatatableheaderfix">
                            <td>专题类型</td>
                            <td>房源id</td>
                            <td>房源类型</td>
                            <td>区县</td>
                            <td>商圈</td>
                            <td>楼盘名称</td>
                            <td>价格</td>
                            <td>物业类型</td>
                            <td>联系人</td>
                            <td>联系电话</td>
                            <td>刷新</td>
                            <td>删除</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="x in items | filter:query">
                            <td>{{x.Ssa_type_desc}}</td>
                            <td>{{x.Ssa_HouseId}}</td>
                            <td>{{gettype(x.Ssa_houseType)}}</td>
                            <td>{{x.Ssa_district}}</td>
                            <td>{{x.Ssa_comarea}}</td>
                            <td>{{x.Ssa_projName}}</td>
                            <td>原始价格{{x.Ssa_price}}-真实价格{{x.Ssa_fact_price}}{{x.Ssa_price_type}}</td>
                            <td>{{x.Ssa_purpose}}</td>
                            <td>{{x.Ssa_link_man}}</td>
                            <td>{{x.Ssa_phone}}</td>
                            <td><a data-id="{{x.Ssa_id}}" ng-click="ref($event.target)">刷新</a> </td>
                            <td><a data-id="{{x.Ssa_id}}" ng-click="del($event.target)">删除</a></td>
                        </tr>
                    </tbody>
                </table>
                <ul class="pagination" ng-show="totalPage>1">
                    <li><a href="javascript:void(0)" ng-click="pageIndex=1;search()">首页</a></li>
                    <li><a href="javascript:void(0);" ng-click="prev()">上一页</a></li>
                    <li ng-repeat="page in pages"><a href="javascript:void(0);" ng-class="{true:'active'}[pageIndex==page]" ng-click="loadPage(page)">{{ page }}</a></li>
                    <li><a href="javascript:void(0);" ng-click="next()">下一页</a>
                    </li>
                    <li><a href="javascript:void(0)"
                        ng-click="pageIndex=totalPage;search()">末页</a></li>
                </ul>
            </div>
    </div></div>
    <script>
        var app = angular.module('myApp', []);
        app.controller('ListController', ["$scope", "$http", function ($scope, $http) {
            $scope.droptype = "1";// 专题类型
            $scope.query = "";// houseid
            $scope.pageSize = 12;// 一页显示的数目
            $scope.pageIndex = 1;// 当前页码
            $scope.pages = []; // 页码集合[1,2,3...]
            $scope.totalPage = 1; // 总数
            $scope.endPage = 1; // 最后一页
            // 查询
            $scope.search = function () {
                $http({
                    params: {
                        pageSize: $scope.pageSize,
                        pageIndex: $scope.pageIndex,
                        htype: $scope.droptype,
                        houseid: $scope.query
                    },
                    url: '/SpecialSubjecActivity/SpecialSubjecActivityList.do',
                    method: "get"
                }).success(function (response) {
                    $scope.items = eval(response.entitylist);

                    $scope.totalPage = Math.ceil(response.count / $scope.pageSize);
                    $scope.endPage = $scope.totalPage;
                    if ($scope.totalPage > 2) {
                        if ($scope.pageIndex > 1 && $scope.pageIndex < $scope.totalPage) {
                            $scope.pages = [
                                $scope.pageIndex - 1,
                                $scope.pageIndex,
                                $scope.pageIndex + 1
                            ];
                        } else if ($scope.pageIndex == 1) {
                            $scope.pages = [
                                $scope.pageIndex,
                                $scope.pageIndex + 1,
                                $scope.pageIndex + 2
                            ];
                        } else if ($scope.pageIndex == $scope.totalPage) {
                            $scope.pages = [
                                $scope.pageIndex - 2,
                                $scope.pageIndex - 1,
                                $scope.pageIndex
                            ];
                        };
                    } else {
                        $scope.pages = [1, 2];
                    }
                })
            }
            // 返回房源类型
            $scope.gettype = function (housetype) {
                switch (housetype) {
                    case 1: return "个人"; break;
                    case 2: return "经纪人"; break;
                    case 3: return "电商"; break;
                    case 4: return "电商合租"; break;
                    default: return ""; break;
                }
            };
            // 下一页
            $scope.next = function () {
                if ($scope.pageIndex < $scope.totalPage) {
                    $scope.pageIndex++;
                    $scope.search();
                }
            };
            // 上一页
            $scope.prev = function () {
                if ($scope.pageIndex > 1) {
                    $scope.pageIndex--;
                    $scope.search();
                }
            };
            // 点击页码
            $scope.loadPage = function (page) {
                $scope.pageIndex = page;
                $scope.search();
            };
            // 刷新
            $scope.ref = function (target) {
                var id = target.getAttribute("data-id"),
                    url = "/SpecialSubjecActivity/FreshenSpecialSubjecActivity.do";

                request(url, id);
            };
            // 删除
            $scope.del = function (target) {
                var id = target.getAttribute("data-id"),
                   url = "/SpecialSubjecActivity/DelSubjecActivity.do";

                request(url, id);
            };
            // 异步请求并返回结果
            function request(url, id) {
                $http.get(url + "?id=" + id).success(function (response) {
                    if (response.code === 100) {
                        $scope.search();
                    }
                    alert(response.message);
                })
            };
            $scope.search();
        }])
    </script>
</body>
</html>
